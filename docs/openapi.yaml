openapi: 3.0.3
info:
  title: 🐈 루틴냥 API 명세서
  description: AI based routine Recommendation Service - 루틴냥 Server의 API 명세서입니다.
  version: v1
servers:
  - url: http://localhost:8080
    description: Local Test Server
security:
  - bearer-key: []
tags:
  - name: Routine Group
    description: 루틴 그룹 API
  - name: Routine
    description: 루틴 API
  - name: User
    description: 유저 API
  - name: Routine Report
    description: 루틴 통계 API
paths:
  /api/users/info/survey-answers:
    get:
      tags:
        - User
      summary: User 설문 정보 조회
      description: 온보딩에서 입력받은 유저의 설문 결과 조회
      operationId: findSurveyAnswers
      parameters:
        - name: user
          in: query
          required: true
          schema:
            $ref: '#/components/schemas/User'
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponseSurveyResponse'
    put:
      tags:
        - User
      summary: User 설문 정보 수정
      description: 유저의 설문 정보 수정
      operationId: updateSurveyAnswers
      requestBody:
        content:
          application/json:
            schema:
              type: array
              items:
                $ref: '#/components/schemas/SurveyDto'
        required: true
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponseSurveyResponse'
  /api/users/info/basics:
    get:
      tags:
        - User
      summary: User 기본 정보 조회
      description: 유저의 이름, 나이, 성별 조회
      operationId: findBasicUserInfo
      parameters:
        - name: user
          in: query
          required: true
          schema:
            $ref: '#/components/schemas/User'
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponseUserBasicInfoDto'
    put:
      tags:
        - User
      summary: User 기본 정보 수정
      description: 유저의 기본 정보 수정
      operationId: updateUserInfo
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UserBasicInfoDto'
        required: true
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponseUserBasicInfoDto'
  /api/routines/{routine-id}:
    get:
      tags:
        - Routine
      summary: Routine 속성 정보 조회
      description: 루틴의 고유 식별자(id)로 수정 가능한 루틴 속성 조회
      operationId: find
      parameters:
        - name: routine-id
          in: path
          required: true
          schema:
            type: integer
            format: int64
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponseRoutineResponse'
    put:
      tags:
        - Routine
      summary: Routine 수정
      description: 루틴의 세부 정보 수정
      operationId: update
      parameters:
        - name: routine-id
          in: path
          required: true
          schema:
            type: integer
            format: int64
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RoutineUpdateRequest'
        required: true
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponseRoutineSummaryResponse'
    delete:
      tags:
        - Routine
      summary: Routine 삭제
      description: 루틴 삭제
      operationId: delete
      parameters:
        - name: routine-id
          in: path
          required: true
          schema:
            type: integer
            format: int64
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponseVoid'
  /api/routines/groups/{routine-group-id}:
    put:
      tags:
        - Routine Group
      summary: Routine Group 수정
      description: 루틴 그룹의 이름을 수정합니다.
      operationId: update_1
      parameters:
        - name: routine-group-id
          in: path
          required: true
          schema:
            type: integer
            format: int64
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RoutineGroupRequest'
        required: true
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponseRoutineGroupResponse'
    delete:
      tags:
        - Routine Group
      summary: Routine Group 삭제
      description: 루틴 그룹을 삭제합니다.
      operationId: delete_1
      parameters:
        - name: routine-group-id
          in: path
          required: true
          schema:
            type: integer
            format: int64
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponseVoid'
  /api/users/onboarding:
    post:
      tags:
        - User
      summary: User 온보딩 정보 저장
      description: 온보딩 화면에서 입력받은 유저의 기본 정보 및 설문 결과 저장
      operationId: saveOnboarding
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UserRequest'
        required: true
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponseUserResponse'
  /api/routines:
    get:
      tags:
        - Routine
      summary: Routine Status 목록 조회 (날짜)
      description: 특정 날짜에 수행해야 하는 루틴의 수행 상태 목록 조회
      operationId: findAllStatusByDate
      parameters:
        - name: date
          in: query
          required: true
          schema:
            type: string
            format: date
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponseListRoutineStatusResponse'
    post:
      tags:
        - Routine
      summary: Routine 생성
      description: 새로운 루틴을 생성
      operationId: create
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RoutineRequest'
        required: true
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponseRoutineSummaryResponse'
  /api/routines/groups:
    get:
      tags:
        - Routine Group
      summary: Routine Group 목록 조회
      description: 로그인한 유저의 루틴 그룹 목록을 조회합니다.
      operationId: findAll
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponseListRoutineGroupResponse'
    post:
      tags:
        - Routine Group
      summary: Routine Group 생성
      description: 루틴 그룹을 생성합니다.
      operationId: create_1
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RoutineGroupRequest'
        required: true
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponseRoutineGroupResponse'
  /api/routines/{routine-id}/toggle:
    patch:
      tags:
        - Routine
      summary: Routine Execution 상태 토글
      description: 루틴을 수행 완료한 상태라면 실패로, 실패한 상태라면 완료로 변경
      operationId: toggleExecution
      parameters:
        - name: routine-id
          in: path
          required: true
          schema:
            type: integer
            format: int64
        - name: date
          in: query
          required: true
          schema:
            type: string
            format: date
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponseVoid'
  /routines/{routine-id}/reports/streak:
    get:
      tags:
        - Routine Report
      summary: Routine 연속 성공 횟수 조회
      description: 현재 연속 횟수와 최대 연속을 달성한 기간 및 횟수 조회
      operationId: getStreakReport
      parameters:
        - name: routine-id
          in: path
          required: true
          schema:
            type: integer
            format: int64
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponseRoutineStreakReportResponse'
  /routines/{routine-id}/reports/recent-completion-rates:
    get:
      tags:
        - Routine Report
      summary: Routine 최근 주별 성공률 조회
      description: 최근 5주간의 루틴 성공률(%) 조회. 성공률은 반올림하여 소수점 첫째자리까지만 반환
      operationId: getRecentWeeklyCompletionRates
      parameters:
        - name: routine-id
          in: path
          required: true
          schema:
            type: integer
            format: int64
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponseListRoutineWeeklyCompletionRateResponse'
  /routines/{routine-id}/reports/monthly:
    get:
      tags:
        - Routine Report
      summary: Routine 월별 성공 횟수 조회
      description: '6개월의 월별 루틴 성공 횟수 조회. 기본은 최근 6개월, 시작 월 지정 가능 '
      operationId: getMonthlyReport
      parameters:
        - name: routine-id
          in: path
          required: true
          schema:
            type: integer
            format: int64
        - name: startYm
          in: query
          required: false
          schema:
            type: string
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponseListRoutineMonthlyReportResponse'
  /routines/{routine-id}/reports/executed-dates/yearly:
    get:
      tags:
        - Routine Report
      summary: 연도별 수행 성공일 조회
      description: 특정 연도 전체의 루틴 수행 성공일 목록 조회
      operationId: getExecutedDatesByYear
      parameters:
        - name: routine-id
          in: path
          required: true
          schema:
            type: integer
            format: int64
        - name: year
          in: query
          required: true
          schema:
            type: integer
            format: int32
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponseRoutineDateListResponse'
  /routines/{routine-id}/reports/executed-dates/weekly:
    get:
      tags:
        - Routine Report
      summary: 주간 수행 성공일 조회
      description: 요청한 startDate를 기준으로 1주일(월~일)의 루틴 수행 성공일 목록 조회
      operationId: getExecutedDatesByWeek
      parameters:
        - name: routine-id
          in: path
          required: true
          schema:
            type: integer
            format: int64
        - name: startDate
          in: query
          required: true
          schema:
            type: string
            format: date
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponseRoutineDateListResponse'
  /routines/{routine-id}/reports/executed-dates/monthly:
    get:
      tags:
        - Routine Report
      summary: 월별 수행 성공일 조회
      description: 특정 연도와 월 기준으로 루틴 수행 성공일 목룍 조회
      operationId: getExecutedDatesByMonth
      parameters:
        - name: routine-id
          in: path
          required: true
          schema:
            type: integer
            format: int64
        - name: year
          in: query
          required: true
          schema:
            type: integer
            format: int32
        - name: month
          in: query
          required: true
          schema:
            type: integer
            format: int32
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponseRoutineDateListResponse'
  /routines/{routine-id}/reports/day-of-week-count:
    get:
      tags:
        - Routine Report
      summary: 요일별 성공 횟수 조회
      description: 루틴의 요일별 성공 횟수 조회
      operationId: getDayOfWeekCount
      parameters:
        - name: routine-id
          in: path
          required: true
          schema:
            type: integer
            format: int64
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponseRoutineDayOfWeekCountResponse'
  /api/users/oauth2/login/success:
    get:
      tags:
        - User
      summary: 구글 로그인 성공 시 응답
      description: 유저의 이름, 온보딩 완료 여부, jwt 토큰 반환
      operationId: oauthLoginSuccess
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserLoginSuccessResponse'
  /api/routines/filter:
    get:
      tags:
        - Routine
      summary: Routine 목록 조회 (필터)
      description: 전체, 그룹별, 종료되지 않은 루틴 조회 + 페이징
      operationId: findAllWithFilter
      parameters:
        - name: groupId
          in: query
          required: false
          schema:
            type: integer
            format: int64
        - name: activeOnly
          in: query
          required: false
          schema:
            type: boolean
            default: false
        - name: page
          in: query
          description: Zero-based page index (0..N)
          required: false
          schema:
            type: integer
            default: 0
            minimum: 0
        - name: size
          in: query
          description: The size of the page to be returned
          required: false
          schema:
            type: integer
            default: 10
            minimum: 1
        - name: sort
          in: query
          description: 'Sorting criteria in the format: property,(asc|desc). Default sort order is ascending. Multiple sort criteria are supported.'
          required: false
          schema:
            type: array
            default:
              - createdAt,DESC
            items:
              type: string
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponsePageRoutineSummaryResponse'
components:
  schemas:
    SurveyDto:
      type: object
      properties:
        question:
          type: string
        answer:
          type: string
    ApiResponseSurveyResponse:
      type: object
      properties:
        success:
          type: boolean
        message:
          type: string
        code:
          type: string
        data:
          $ref: '#/components/schemas/SurveyResponse'
    SurveyResponse:
      type: object
      properties:
        totalCount:
          type: integer
          format: int32
        savedSurveys:
          type: array
          items:
            $ref: '#/components/schemas/SurveyDto'
    UserBasicInfoDto:
      type: object
      properties:
        name:
          type: string
        dateOfBirth:
          type: string
          format: date
        gender:
          type: string
    ApiResponseUserBasicInfoDto:
      type: object
      properties:
        success:
          type: boolean
        message:
          type: string
        code:
          type: string
        data:
          $ref: '#/components/schemas/UserBasicInfoDto'
    RoutineUpdateRequest:
      type: object
      properties:
        name:
          type: string
        repeatDays:
          type: array
          items:
            type: string
            enum:
              - MONDAY
              - TUESDAY
              - WEDNESDAY
              - THURSDAY
              - FRIDAY
              - SATURDAY
              - SUNDAY
          uniqueItems: true
        preferredTime:
          type: string
        endDate:
          type: string
          format: date
        color:
          type: string
        groupId:
          type: integer
          format: int64
    ApiResponseRoutineSummaryResponse:
      type: object
      properties:
        success:
          type: boolean
        message:
          type: string
        code:
          type: string
        data:
          $ref: '#/components/schemas/RoutineSummaryResponse'
    RoutineSummaryResponse:
      type: object
      properties:
        routineId:
          type: integer
          format: int64
        name:
          type: string
    RoutineGroupRequest:
      type: object
      properties:
        name:
          type: string
    ApiResponseRoutineGroupResponse:
      type: object
      properties:
        success:
          type: boolean
        message:
          type: string
        code:
          type: string
        data:
          $ref: '#/components/schemas/RoutineGroupResponse'
    RoutineGroupResponse:
      type: object
      properties:
        groupId:
          type: integer
          format: int64
        name:
          type: string
    UserRequest:
      type: object
      properties:
        name:
          type: string
        dateOfBirth:
          type: string
          format: date
        gender:
          type: string
        surveys:
          type: array
          items:
            $ref: '#/components/schemas/SurveyDto'
    ApiResponseUserResponse:
      type: object
      properties:
        success:
          type: boolean
        message:
          type: string
        code:
          type: string
        data:
          $ref: '#/components/schemas/UserResponse'
    UserResponse:
      type: object
      properties:
        userId:
          type: integer
          format: int64
        email:
          type: string
        dateOfBirth:
          type: string
          format: date
        gender:
          type: string
        surveyResponse:
          $ref: '#/components/schemas/SurveyResponse'
    RoutineRequest:
      type: object
      properties:
        name:
          type: string
        repeatDays:
          type: array
          items:
            type: string
            enum:
              - MONDAY
              - TUESDAY
              - WEDNESDAY
              - THURSDAY
              - FRIDAY
              - SATURDAY
              - SUNDAY
          uniqueItems: true
        preferredTime:
          type: string
        startDate:
          type: string
          format: date
        endDate:
          type: string
          format: date
        color:
          type: string
        groupId:
          type: integer
          format: int64
    ApiResponseVoid:
      type: object
      properties:
        success:
          type: boolean
        message:
          type: string
        code:
          type: string
        data:
          type: object
    ApiResponseRoutineStreakReportResponse:
      type: object
      properties:
        success:
          type: boolean
        message:
          type: string
        code:
          type: string
        data:
          $ref: '#/components/schemas/RoutineStreakReportResponse'
    RoutineStreakReportResponse:
      type: object
      properties:
        currentStreak:
          type: integer
          format: int32
        maxStreak:
          type: integer
          format: int32
        maxStreakStartDate:
          type: string
          format: date
        maxStreakEndDate:
          type: string
          format: date
    ApiResponseListRoutineWeeklyCompletionRateResponse:
      type: object
      properties:
        success:
          type: boolean
        message:
          type: string
        code:
          type: string
        data:
          type: array
          items:
            $ref: '#/components/schemas/RoutineWeeklyCompletionRateResponse'
    RoutineWeeklyCompletionRateResponse:
      type: object
      properties:
        weekStartDate:
          type: string
          format: date
        totalScheduled:
          type: integer
          format: int32
        completed:
          type: integer
          format: int32
        rate:
          type: number
          format: double
    ApiResponseListRoutineMonthlyReportResponse:
      type: object
      properties:
        success:
          type: boolean
        message:
          type: string
        code:
          type: string
        data:
          type: array
          items:
            $ref: '#/components/schemas/RoutineMonthlyReportResponse'
    RoutineMonthlyReportResponse:
      type: object
      properties:
        year:
          type: integer
          format: int32
        month:
          type: integer
          format: int32
        successCount:
          type: integer
          format: int32
    ApiResponseRoutineDateListResponse:
      type: object
      properties:
        success:
          type: boolean
        message:
          type: string
        code:
          type: string
        data:
          $ref: '#/components/schemas/RoutineDateListResponse'
    RoutineDateListResponse:
      type: object
      properties:
        completedDates:
          type: array
          items:
            type: string
            format: date
    ApiResponseRoutineDayOfWeekCountResponse:
      type: object
      properties:
        success:
          type: boolean
        message:
          type: string
        code:
          type: string
        data:
          $ref: '#/components/schemas/RoutineDayOfWeekCountResponse'
    RoutineDayOfWeekCountResponse:
      type: object
      properties:
        dayOfWeekCountMap:
          type: object
          additionalProperties:
            type: integer
            format: int32
    UserLoginSuccessResponse:
      type: object
      description: 구글 로그인 성공 후 응답
      properties:
        onboardingFinished:
          type: boolean
        userName:
          type: string
        token:
          type: string
    User:
      type: object
      properties:
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time
        id:
          type: integer
          format: int64
        email:
          type: string
        name:
          type: string
        onBoardingFinished:
          type: boolean
        dateOfBirth:
          type: string
          format: date
        gender:
          type: string
        userSurveys:
          type: array
          items:
            $ref: '#/components/schemas/UserSurvey'
    UserSurvey:
      type: object
      properties:
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time
        id:
          type: integer
          format: int64
        question:
          type: string
        answer:
          type: string
        user:
          $ref: '#/components/schemas/User'
    ApiResponseListRoutineStatusResponse:
      type: object
      properties:
        success:
          type: boolean
        message:
          type: string
        code:
          type: string
        data:
          type: array
          items:
            $ref: '#/components/schemas/RoutineStatusResponse'
    RoutineStatusResponse:
      type: object
      properties:
        routineId:
          type: integer
          format: int64
        name:
          type: string
        color:
          type: string
        completed:
          type: boolean
    ApiResponseRoutineResponse:
      type: object
      properties:
        success:
          type: boolean
        message:
          type: string
        code:
          type: string
        data:
          $ref: '#/components/schemas/RoutineResponse'
    RoutineResponse:
      type: object
      properties:
        name:
          type: string
        repeatDays:
          type: array
          items:
            type: string
            enum:
              - MONDAY
              - TUESDAY
              - WEDNESDAY
              - THURSDAY
              - FRIDAY
              - SATURDAY
              - SUNDAY
          uniqueItems: true
        preferredTime:
          type: string
        startDate:
          type: string
          format: date
        endDate:
          type: string
          format: date
        color:
          type: string
        groupId:
          type: integer
          format: int64
    ApiResponseListRoutineGroupResponse:
      type: object
      properties:
        success:
          type: boolean
        message:
          type: string
        code:
          type: string
        data:
          type: array
          items:
            $ref: '#/components/schemas/RoutineGroupResponse'
    ApiResponsePageRoutineSummaryResponse:
      type: object
      properties:
        success:
          type: boolean
        message:
          type: string
        code:
          type: string
        data:
          $ref: '#/components/schemas/PageRoutineSummaryResponse'
    PageRoutineSummaryResponse:
      type: object
      properties:
        totalElements:
          type: integer
          format: int64
        totalPages:
          type: integer
          format: int32
        size:
          type: integer
          format: int32
        content:
          type: array
          items:
            $ref: '#/components/schemas/RoutineSummaryResponse'
        number:
          type: integer
          format: int32
        sort:
          $ref: '#/components/schemas/SortObject'
        first:
          type: boolean
        last:
          type: boolean
        numberOfElements:
          type: integer
          format: int32
        pageable:
          $ref: '#/components/schemas/PageableObject'
        empty:
          type: boolean
    PageableObject:
      type: object
      properties:
        offset:
          type: integer
          format: int64
        sort:
          $ref: '#/components/schemas/SortObject'
        paged:
          type: boolean
        pageNumber:
          type: integer
          format: int32
        pageSize:
          type: integer
          format: int32
        unpaged:
          type: boolean
    SortObject:
      type: object
      properties:
        empty:
          type: boolean
        sorted:
          type: boolean
        unsorted:
          type: boolean
  securitySchemes:
    bearer-key:
      type: http
      description: JWT 토큰 키를 입력해주세요!
      scheme: bearer
      bearerFormat: JWT
